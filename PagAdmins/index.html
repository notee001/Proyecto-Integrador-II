<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coordenadas Aleatorias - Verificación JWT</title>

  <!-- Mapbox -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="panel">
    <div id="userInfo" style="margin-bottom: 0; font-weight: bold;"></div>

    <button id="generar" style="display: none;">Generar 6 coordenadas aleatorias</button>
    <button id="saveButton" disabled style="display: none;">Guardar Coordenadas</button>
    
    <!-- Dropdown Menu -->
    <div class="dropdown-container">
      <button id="dropdownBtn" style="display: none;">Opciones</button>
      <div id="dropdownMenu" class="dropdown-menu">
        <a href="#" id="verTabla">Ver tabla de coordenadas</a>
        <a href="#" id="registroBtn" style="display: none;">Registrar nuevo usuario</a>
        <a href="#" id="logoutLink">Cerrar Sesión</a>
      </div>
    </div>
  </div>

  <pre id="output"></pre>
  <div id="map"></div>

  <!-- Modal para ver coordenadas -->
  <div id="coordinatesModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Coordenadas Guardadas</h2>
        <button class="close-btn" id="closeModal">&times;</button>
      </div>

      <div id="tableContainer">
        <table class="coordinates-table" id="coordinatesTable">
          <thead>
            <tr>
              <th>Seleccionar</th>
              <th>#</th>
              <th>Latitud</th>
              <th>Longitud</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Se llenará dinámicamente -->
          </tbody>
        </table>
      </div>

      <!-- Formulario para crear conglomerado -->
      <div id="conglomeradoForm" class="conglomerado-form">
        <h3>Crear Conglomerado</h3>
        <div class="form-group">
          <label for="fechaInicio">Fecha de Inicio:</label>
          <input type="date" id="fechaInicio" required />
        </div>
        <div class="form-group">
          <label for="descripcion">Descripción:</label>
          <textarea id="descripcion" placeholder="Ingrese una descripción" required></textarea>
        </div>
        
        <div class="form-group">
          <label for="usuarioJefe">Jefe de Brigada:</label>
          <select id="usuarioJefe" class="usuario-select" required>
            <option value="">Seleccione un usuario</option>
          </select>
        </div>

        <div class="form-group">
          <label for="usuarioBotanico">Botánico:</label>
          <select id="usuarioBotanico" class="usuario-select" required>
            <option value="">Seleccione un usuario</option>
          </select>
        </div>

        <div class="form-group">
          <label for="usuarioTecnico">Técnico Auxiliar:</label>
          <select id="usuarioTecnico" class="usuario-select" required>
            <option value="">Seleccione un usuario</option>
          </select>
        </div>

        <div class="form-group">
          <label for="usuarioCoinvestigador">Coinvestigador:</label>
          <select id="usuarioCoinvestigador" class="usuario-select" required>
            <option value="">Seleccione un usuario</option>
          </select>
        </div>

        <button id="guardarConglomerado" class="btn-guardar">Guardar Conglomerado</button>
      </div>
    </div>
  </div>

  <!-- Modal para registrar nuevo usuario -->
  <div id="registroModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Registrar Nuevo Usuario</h2>
        <button class="close-btn" id="closeRegistroModal">&times;</button>
      </div>

      <div id="registroFormContainer">
        <form id="formularioRegistroAdmin">
          <div class="form-group">
            <label for="emailRegistro">Correo Electrónico:</label>
            <input type="email" id="emailRegistro" name="emailRegistro" placeholder="ejemplo@correo.com" required />
          </div>

          <div class="form-group">
            <label for="nombreRegistro">Nombre Completo:</label>
            <input type="text" id="nombreRegistro" name="nombreRegistro" placeholder="Nombre completo" required />
          </div>

          <div class="form-group">
            <label for="tipoRegistro">Tipo de Usuario:</label>
            <select id="tipoRegistro" name="tipoRegistro" required onchange="alternarUbicacionYRoles()">
              <option value="">Seleccione un tipo</option>
              <option value="admin">Administrador</option>
              <option value="usuario">Usuario</option>
            </select>
          </div>

          <div class="form-group">
            <label for="passwordRegistro">Contraseña:</label>
            <input type="password" id="passwordRegistro" name="passwordRegistro" placeholder="Ingrese una contraseña" required />
          </div>

          <!-- Ubicación (solo para usuarios) -->
          <div id="ubicacionSection" style="display: none;">
            <div class="form-group">
              <label>Ubicación (Latitud y Longitud):</label>
              <div id="mapRegistro" style="width: 100%; height: 300px; border-radius: 5px; margin-bottom: 10px; border: 2px solid #ddd;"></div>
              <div style="background: #f0f0f0; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 13px; color: #666;">
                Haz clic en el mapa para seleccionar la ubicación del usuario
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div>
                  <label for="latitudRegistro">Latitud:</label>
                  <input type="number" id="latitudRegistro" step="0.000001" placeholder="Latitud" readonly />
                </div>
                <div>
                  <label for="longitudRegistro">Longitud:</label>
                  <input type="number" id="longitudRegistro" step="0.000001" placeholder="Longitud" readonly />
                </div>
              </div>
            </div>
          </div>

          <!-- Roles (solo para usuarios) -->
          <div id="rolesSection" style="display: none;">
            <div class="form-group">
              <label>Selecciona los Roles:</label>
              <div class="roles-checkboxes">
                <label class="checkbox-role">
                  <input type="checkbox" class="rol-check" value="Jefe de brigada" />
                  Jefe de brigada
                </label>
                <label class="checkbox-role">
                  <input type="checkbox" class="rol-check" value="Botanico" />
                  Botánico
                </label>
                <label class="checkbox-role">
                  <input type="checkbox" class="rol-check" value="Tecnico auxiliar" />
                  Técnico auxiliar
                </label>
                <label class="checkbox-role">
                  <input type="checkbox" class="rol-check" value="Coinvestigador" />
                  Coinvestigador
                </label>
              </div>
              <span class="error" id="errorRoles"></span>
            </div>
          </div>

          <button type="submit" class="btn-guardar">Registrar Usuario</button>
          <span class="error" id="errorRegistro"></span>
          <span class="success" id="successRegistro"></span>
        </form>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="config.js"></script>
  <script src="utils.js"></script>
  <script src="coordinates.js"></script>
  <script src="conglomerados.js"></script>
  <script src="registro-admin.js"></script>
  <script src="app.js"></script>  
  
</body>
</html>


